<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ehworld</title>
    <link rel="icon" href="../static/img/icon.png" type="image">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/avatar.css">
    <link rel="stylesheet" href="../static/css/feed.css">
    <link rel="stylesheet" href="../static/css/header.css">
    <link rel="stylesheet" href="../static/css/footer.css">
    <link rel="stylesheet" href="../static/css/search.css">
</head>
<body>
    <script src="../static/js/search.js"></script>
    <header class="header">
        <a href="/main" class="logo">
            <img src="../static/img/EhWorld.svg" width="128">
        </a>
        
        <div class="nav-links">
            <a href="/main">Главная</a>
            <a href="/feed">Лента</a>
            <a href="/shop">Магазин</a>
            <a href="/upload">Загрузить</a>
            {{ if checkModRole .ID}}
            <a href="/moderator">Модерация</a>
            {{ end}}
            {{ if checkAdminRole .ID}}
            <a href="/admin">Админ панель</a>
            {{ end}}
        </div>
        
        <div class="search-container">
            <div class="search-box-container">
                <input 
                    id="searchInput"
                    type="search" 
                    class="search-box" 
                    placeholder="Поиск..."
                >
                <div class="search-results" id="searchResults"></div>
            </div>

            <div class="avatar-dropdown">
            <img src="{{.ProfileImageURL}}" alt="Аватар" class="user-avatar" id="avatarDropdown">
            <div class="dropdown-content" id="dropdownContent">
                <div class="user-info">
                    <span class="username">{{.DisplayName}}</span>
                </div>
                <div class="dropdown-divider"></div>
                <a href="/profile" class="dropdown-link">
                    Профиль
                </a>
                <a href="/settings" class="dropdown-link">
                    Настройки
                </a>
                <a href="/logout" class="dropdown-link logout-button">
                    Выйти
                </a>
            </div>
        </div>
        </div>
    </header>

    <div class="feed-container">
        <!-- Пост 1 -->
        <div class="post-card" data-post-id="1">
            <div class="post-header">
                <img src="{{.ProfileImageURL}}" alt="Аватар" class="post-avatar">
                <div>
                    <div class="post-author">Алексей Петров</div>
                    <span class="post-time">2 часа назад</span>
                </div>
            </div>
            
            <img src="../static/uploads/123_1754337836740794300.png" alt="Пост" class="post-media">
            
            <div class="post-footer">
                <div class="post-stats">
                    <div class="like-container">
                        <button class="like-btn" onclick="toggleLike(this)">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path d="M16.5,3C13.605,3,12,5.09,12,5.09S10.395,3,7.5,3C4.462,3,2,5.462,2,8.5c0,4.171,4.912,8.8,10,12.5 c5.088-3.7,10-8.329,10-12.5C22,5.462,19.538,3,16.5,3z" fill="#65676B"/>
                            </svg>
                        </button>
                        <span class="like-count">142</span>
                    </div>
                    <div class="view-count">1.2K просмотров</div>
                </div>
                
                <div class="post-actions">
                    <button class="goto-post-btn" onclick="goToPost(1)">Перейти к посту</button>
                </div>
                
                <div class="post-caption">
                    Прекрасный вид на горы сегодня утром. Ничто не сравнится с природой в ее первозданной красоте!
                </div>
            </div>
        </div>
        
        <!-- Пост 2 (с видео) -->
        <div class="post-card" data-post-id="2">
            <div class="post-header">
                <img src="{{.ProfileImageURL}}" alt="Аватар" class="post-avatar">
                <div>
                    <div class="post-author">Мария Иванова</div>
                    <span class="post-time">5 часов назад</span>
                </div>
            </div>
            
            <div class="video-container">
                <img src="../static/uploads/7c600fe6e5d2acda1f2e429a4ac60363_1754397733878385700.jpg" alt="Видео превью" class="post-media">
                <div class="video-play-btn" onclick="playVideo(this)"></div>
            </div>
            
            <div class="post-footer">
                <div class="post-stats">
                    <div class="like-container">
                        <button class="like-btn" onclick="toggleLike(this)">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path d="M16.5,3C13.605,3,12,5.09,12,5.09S10.395,3,7.5,3C4.462,3,2,5.462,2,8.5c0,4.171,4.912,8.8,10,12.5 c5.088-3.7,10-8.329,10-12.5C22,5.462,19.538,3,16.5,3z" fill="#65676B"/>
                            </svg>
                        </button>
                        <span class="like-count">89</span>
                    </div>
                    <div class="view-count">854 просмотра</div>
                </div>
                
                <div class="post-actions">
                    <button class="goto-post-btn" onclick="goToPost(2)">Перейти к посту</button>
                </div>
                
                <div class="post-caption">
                    Прогулка по вечернему городу. Очень атмосферное место с красивой архитектурой.
                </div>
            </div>
        </div>
        
        <!-- Пост 3 -->
        <div class="post-card" data-post-id="3">
            <div class="post-header">
                <img src="{{.ProfileImageURL}}" alt="Аватар" class="post-avatar">
                <div>
                    <div class="post-author">Дмитрий Смирнов</div>
                    <span class="post-time">вчера</span>
                </div>
            </div>
            
            <img src="../static/uploads/0c670baa-948e-4ab9-8eec-338f1ff7c064_logo_1754397107785633300.mp4" alt="Пост" class="post-media">
            
            <div class="post-footer">
                <div class="post-stats">
                    <div class="like-container">
                        <button class="like-btn liked" onclick="toggleLike(this)">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path d="M16.5,3C13.605,3,12,5.09,12,5.09S10.395,3,7.5,3C4.462,3,2,5.462,2,8.5c0,4.171,4.912,8.8,10,12.5 c5.088-3.7,10-8.329,10-12.5C22,5.462,19.538,3,16.5,3z" fill="#FF0000"/>
                            </svg>
                        </button>
                        <span class="like-count">256</span>
                    </div>
                    <div class="view-count">2.4K просмотров</div>
                </div>
                
                <div class="post-actions">
                    <button class="goto-post-btn" onclick="goToPost(3)">Перейти к посту</button>
                </div>
                
                <div class="post-caption">
                    Сегодня приготовил свой фирменный десерт. Рецепт простой, а результат восхитительный!
                </div>
            </div>
        </div>
        
        <!-- Пост 4 -->
        <div class="post-card" data-post-id="4">
            <div class="post-header">
                <img src="https://randomuser.me/api/portraits/women/68.jpg" alt="Аватар" class="post-avatar">
                <div>
                    <div class="post-author">Елена Васильева</div>
                    <span class="post-time">2 дня назад</span>
                </div>
            </div>
            
            <img src="https://source.unsplash.com/random/600x600?art" alt="Пост" class="post-media">
            
            <div class="post-footer">
                <div class="post-stats">
                    <div class="like-container">
                        <button class="like-btn" onclick="toggleLike(this)">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path d="M16.5,3C13.605,3,12,5.09,12,5.09S10.395,3,7.5,3C4.462,3,2,5.462,2,8.5c0,4.171,4.912,8.8,10,12.5 c5.088-3.7,10-8.329,10-12.5C22,5.462,19.538,3,16.5,3z" fill="#65676B"/>
                            </svg>
                        </button>
                        <span class="like-count">321</span>
                    </div>
                    <div class="view-count">3.1K просмотров</div>
                </div>
                
                <div class="post-actions">
                    <button class="goto-post-btn" onclick="goToPost(4)">Перейти к посту</button>
                </div>
                
                <div class="post-caption">
                    Моя новая картина маслом. Вдохновлялась осенними пейзажами за окном.
                </div>
            </div>
        </div>
    </div>

    <div class="scroll-indicator">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#666">
            <path d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"/>
        </svg>
        <div>Прокрутите вниз</div>
    </div>
    
    <!-- Уведомление о Cookie -->
    <div class="cookie-notice" id="cookieNotice">
        <a>Файлы Cookie</a>
        <p>Используя наш сайт, вы даете согласие на использование технических файлов Cookie. Мы используем минимальный набор информации, необходимый для функционирования сайта.</p>
        <button class="cookie-btn" id="cookieButton">Good nice</button>
    </div>

    <script>
        // Функция переключения лайка
        function toggleLike(btn) {
            const likeBtn = btn;
            const likeCount = likeBtn.nextElementSibling;
            let count = parseInt(likeCount.textContent);
            
            if (likeBtn.classList.contains('liked')) {
                likeBtn.classList.remove('liked');
                likeBtn.querySelector('path').setAttribute('fill', '#65676B');
                likeCount.textContent = count - 1;
            } else {
                likeBtn.classList.add('liked');
                likeBtn.querySelector('path').setAttribute('fill', '#FF0000');
                likeCount.textContent = count + 1;
            }
        }
        
        // Функция воспроизведения видео
        function playVideo(btn) {
            const videoContainer = btn.parentElement;
            const videoPreview = videoContainer.querySelector('.post-media');
            
            // Заменим превью на видео (в реальном приложении здесь будет тег video)
            videoPreview.src = "https://source.unsplash.com/random/600x400?video";
            btn.style.display = 'none';
            
            // В реальном приложении здесь будет video.play()
        }
        
        // Функция перехода к посту
        function goToPost(postId) {
            alert(`Переход к посту #${postId}`);
            // В реальном приложении здесь будет переход на страницу поста
        }
        
        // Скролл к следующему посту
        let currentPostIndex = 0;
        const posts = document.querySelectorAll('.post-card');
        
        function scrollToNextPost() {
            if (currentPostIndex < posts.length - 1) {
                currentPostIndex++;
                posts[currentPostIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }
        
        // Обработчик колеса мыши для быстрой навигации
        let scrollTimeout;
        document.addEventListener('wheel', function(e) {
            clearTimeout(scrollTimeout);
            
            // Определяем направление скролла
            const isScrollingDown = e.deltaY > 0;
            
            if (isScrollingDown) {
                scrollTimeout = setTimeout(scrollToNextPost, 100);
            }
        });

        // Проверяем, было ли уже принято соглашение
        window.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('cookieAccepted') === 'true') {
                document.getElementById('cookieNotice').style.display = 'none';
            }
        });

        // Обработчик для кнопки Cookie
        document.getElementById('cookieButton').addEventListener('click', function() {
            const cookieNotice = document.getElementById('cookieNotice');
            
            // Добавляем класс для запуска анимации исчезновения
            cookieNotice.classList.add('hide');
            
            // После завершения анимации скрываем элемент и сохраняем согласие
            setTimeout(() => {
                cookieNotice.style.display = 'none';
                localStorage.setItem('cookieAccepted', 'true');
            }, 500); // Должно соответствовать времени анимации (0.5s)
        });
        
        
        
        // Адаптация к изменению размера окна
        window.addEventListener('resize', function() {
            // Пересчитываем позиции строк при изменении размера окна
            const rows = document.querySelectorAll('.text-row');
            rows.forEach((row, i) => {
                row.style.top = `${i * rowHeight}px`;
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</body>
</html>